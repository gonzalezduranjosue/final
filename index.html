<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BudgetPlanPro - Presupuesto Profesional</title>
    
    <!-- 1. ESTILOS: Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3498db',
                        secondary: '#2c3e50',
                        accent: '#e74c3c',
                        success: '#2ecc71',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>

    <!-- 2. LIBRERÍAS DE LÓGICA (React, DOM, Docx, FileSaver) -->
    <!-- React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para traducir JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Librerías para generar Word -->
    <script src="https://unpkg.com/docx@7.8.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body class="bg-slate-100 text-slate-800 antialiased min-h-screen">
    
    <div id="root"></div>

    <!-- 3. LÓGICA DE LA APLICACIÓN -->
    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- ICONOS SVG (Para no depender de librerías externas complejas) ---
        const Icons = {
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            FileDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="m9 15 3 3 3-3"/></svg>,
            HardHat: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z"/><path d="M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5"/><path d="M4 15v-3a6 6 0 0 1 6-6h0"/><path d="M14 6h0a6 6 0 0 1 6 6v3"/></svg>,
            Hammer: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25V7.86c0-.55-.45-1-1-1H14.5c-.55 0-1 .45-1 1v.36c0 .84-.33 1.65-.93 2.25L11.36 11.7"/><path d="m16 5 3-3"/><path d="m12 9 3-3"/></svg>,
            PenTool: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>,
            Utensils: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
            ClipboardList: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>
        };

        // --- CONSTANTES ---
        const UNITS = [
            { value: 'unidad', label: 'Unidad' },
            { value: 'bolsa', label: 'Bolsa' },
            { value: 'kg', label: 'Kg' },
            { value: 'm', label: 'm' },
            { value: 'm2', label: 'm²' },
            { value: 'm3', label: 'm³' },
            { value: 'l', label: 'Litro' },
            { value: 'juego', label: 'Juego' },
            { value: 'caja', label: 'Caja' },
            { value: 'otro', label: 'Otro' },
        ];

        // --- SERVICIO DE GENERACIÓN DE DOCUMENTOS (WORD) ---
        const generateDocument = async (project, workers, materials, labor, diet, lang) => {
            const { Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell, WidthType, HeadingLevel, AlignmentType, ShadingType, BorderStyle } = window.docx;
            
            const TRANSLATIONS = {
                es: {
                    title: "RESUMEN DE PRESUPUESTO",
                    beneficiary: "Beneficiario:",
                    mainWorker: "Albañil Principal:",
                    otherWorkers: "Otros Trabajadores:",
                    materials: "MATERIALES UTILIZADOS",
                    labor: "TRABAJOS REALIZADOS",
                    diets: "DIETAS",
                    materialsTotal: "TOTAL MATERIALES:",
                    laborTotal: "TOTAL MANO DE OBRA:",
                    dietsTotal: "TOTAL DIETAS:",
                    finalTotal: "PRESUPUESTO TOTAL:",
                    approvedBy: "Aprobado por:",
                    date: "Fecha:",
                    description: "Descripción",
                    quantity: "Cant.",
                    unit: "Unidad",
                    unitPrice: "P. Unit.",
                    total: "Total",
                    workDescription: "Descripción del Trabajo",
                    cost: "Costo",
                    workers: "trabajadores",
                    days: "días",
                    perMeal: "c/u",
                    currency: "MN",
                    signature: "Firma",
                },
                en: {
                    title: "BUDGET SUMMARY",
                    beneficiary: "Beneficiary:",
                    mainWorker: "Main Worker:",
                    otherWorkers: "Other Workers:",
                    materials: "MATERIALS USED",
                    labor: "WORK PERFORMED",
                    diets: "MEALS / DIETS",
                    materialsTotal: "TOTAL MATERIALS:",
                    laborTotal: "TOTAL LABOR:",
                    dietsTotal: "TOTAL MEALS:",
                    finalTotal: "TOTAL BUDGET:",
                    approvedBy: "Approved by:",
                    date: "Date:",
                    description: "Description",
                    quantity: "Qty",
                    unit: "Unit",
                    unitPrice: "U. Price",
                    total: "Total",
                    workDescription: "Work Description",
                    cost: "Cost",
                    workers: "workers",
                    days: "days",
                    perMeal: "ea",
                    currency: "MN",
                    signature: "Signature",
                }
            };

            const t = TRANSLATIONS[lang];
            
            // Cálculos
            const materialTotal = materials.reduce((sum, item) => sum + (item.quantity * item.unitPrice), 0);
            const laborTotal = labor.reduce((sum, item) => sum + item.cost, 0);
            const dietTotal = diet.workersCount * diet.days * diet.costPerDay;
            const grandTotal = materialTotal + laborTotal + dietTotal;

            const CELL_SHADING = { fill: "3498db", type: ShadingType.SOLID, color: "FFFFFF" };
            const BORDER_STYLE = { style: BorderStyle.SINGLE, size: 1, color: "CCCCCC" };

            // Helpers
            const createHeaderCell = (text, width) => new TableCell({
                width: { size: width, type: WidthType.PERCENTAGE },
                shading: CELL_SHADING,
                children: [new Paragraph({ children: [new TextRun({ text, bold: true, color: "FFFFFF" })], alignment: AlignmentType.CENTER })],
                borders: { top: BORDER_STYLE, bottom: BORDER_STYLE, left: BORDER_STYLE, right: BORDER_STYLE }
            });

            const createCell = (text, align = AlignmentType.LEFT) => new TableCell({
                children: [new Paragraph({ text: String(text), alignment: align })],
                borders: { top: BORDER_STYLE, bottom: BORDER_STYLE, left: BORDER_STYLE, right: BORDER_STYLE },
                verticalAlign: "center",
                margins: { top: 100, bottom: 100, left: 100, right: 100 }
            });

            const sections = [];

            // CABECERA
            sections.push(
                new Paragraph({ text: t.title, heading: HeadingLevel.TITLE, alignment: AlignmentType.CENTER, spacing: { after: 200 } }),
                new Paragraph({ children: [new TextRun({ text: project.projectName, bold: true, size: 28 })], alignment: AlignmentType.CENTER, spacing: { after: 400 } }),
                new Paragraph({ children: [new TextRun({ text: `${t.beneficiary} `, bold: true }), new TextRun({ text: project.beneficiary || "---" })], spacing: { after: 100 } })
            );

            // TRABAJADORES
            const mainWorker = workers.find(w => w.role === 'Principal');
            const otherWorkers = workers.filter(w => w.role !== 'Principal').map(w => w.name).join(', ');
            sections.push(new Paragraph({ children: [new TextRun({ text: `${t.mainWorker} `, bold: true }), new TextRun({ text: mainWorker?.name || "---" })], spacing: { after: 100 } }));
            if (otherWorkers) {
                sections.push(new Paragraph({ children: [new TextRun({ text: `${t.otherWorkers} `, bold: true }), new TextRun({ text: otherWorkers })], spacing: { after: 400 } }));
            }

            // MATERIALES
            if (materials.length > 0) {
                sections.push(new Paragraph({ text: t.materials, heading: HeadingLevel.HEADING_2, spacing: { before: 200, after: 200 } }));
                sections.push(new Table({
                    width: { size: 100, type: WidthType.PERCENTAGE },
                    rows: [
                        new TableRow({ children: [createHeaderCell(t.description, 40), createHeaderCell(t.quantity, 10), createHeaderCell(t.unit, 15), createHeaderCell(t.unitPrice, 15), createHeaderCell(t.total, 20)] }),
                        ...materials.map(m => new TableRow({ children: [
                            createCell(m.description),
                            createCell(m.quantity, AlignmentType.CENTER),
                            createCell(m.unit, AlignmentType.CENTER),
                            createCell(`$${m.unitPrice.toFixed(2)}`, AlignmentType.RIGHT),
                            createCell(`$${(m.quantity * m.unitPrice).toFixed(2)}`, AlignmentType.RIGHT),
                        ] }))
                    ]
                }));
                sections.push(new Paragraph({ children: [new TextRun({ text: t.materialsTotal + " ", bold: true }), new TextRun({ text: `$${materialTotal.toFixed(2)} ${t.currency}` })], alignment: AlignmentType.RIGHT, spacing: { before: 200 } }));
            }

            // MANO DE OBRA
            if (labor.length > 0) {
                sections.push(new Paragraph({ text: t.labor, heading: HeadingLevel.HEADING_2, spacing: { before: 400, after: 200 } }));
                sections.push(new Table({
                    width: { size: 100, type: WidthType.PERCENTAGE },
                    rows: [
                        new TableRow({ children: [createHeaderCell(t.workDescription, 75), createHeaderCell(t.cost, 25)] }),
                        ...labor.map(l => new TableRow({ children: [createCell(l.description), createCell(`$${l.cost.toFixed(2)}`, AlignmentType.RIGHT)] }))
                    ]
                }));
                sections.push(new Paragraph({ children: [new TextRun({ text: t.laborTotal + " ", bold: true }), new TextRun({ text: `$${laborTotal.toFixed(2)} ${t.currency}` })], alignment: AlignmentType.RIGHT, spacing: { before: 200 } }));
            }

            // DIETAS
            if (diet.workersCount > 0 && diet.days > 0) {
                sections.push(
                    new Paragraph({ text: t.diets, heading: HeadingLevel.HEADING_2, spacing: { before: 400, after: 200 } }),
                    new Paragraph({ text: `${diet.workersCount} ${t.workers} x ${diet.days} ${t.days} @ $${diet.costPerDay.toFixed(2)} ${t.perMeal}`, alignment: AlignmentType.RIGHT }),
                    new Paragraph({ children: [new TextRun({ text: t.dietsTotal + " ", bold: true }), new TextRun({ text: `$${dietTotal.toFixed(2)} ${t.currency}` })], alignment: AlignmentType.RIGHT, spacing: { before: 100 } })
                );
            }

            // TOTAL Y FIRMAS
            sections.push(
                new Paragraph({ children: [new TextRun({ text: "____________________________________________________________", color: "CCCCCC" })], alignment: AlignmentType.CENTER, spacing: { before: 400, after: 200 } }),
                new Paragraph({ children: [new TextRun({ text: t.finalTotal + " ", bold: true, size: 28 }), new TextRun({ text: `$${grandTotal.toFixed(2)} ${t.currency}`, bold: true, size: 28, color: "2c3e50" })], alignment: AlignmentType.CENTER, spacing: { after: 600 } })
            );

            if (project.observations) {
                sections.push(new Paragraph({ text: "Observaciones / Observations:", bold: true }), new Paragraph({ text: project.observations, spacing: { after: 400 } }));
            }

            // Tabla de Firmas
            sections.push(new Table({
                width: { size: 100, type: WidthType.PERCENTAGE },
                borders: { top: { style: BorderStyle.NONE }, bottom: { style: BorderStyle.NONE }, left: { style: BorderStyle.NONE }, right: { style: BorderStyle.NONE }, insideVertical: { style: BorderStyle.NONE }, insideHorizontal: { style: BorderStyle.NONE } },
                rows: [new TableRow({ children: [
                    new TableCell({ children: [new Paragraph({ children: [new TextRun({ text: `${t.approvedBy} ${project.approverName}`, bold: true })] }), new Paragraph({ text: "\n\n__________________________" }), new Paragraph({ text: t.signature })], width: { size: 50, type: WidthType.PERCENTAGE } }),
                    new TableCell({ children: [new Paragraph({ children: [new TextRun({ text: `${t.date} ${project.approvalDate}`, bold: true })], alignment: AlignmentType.RIGHT })], width: { size: 50, type: WidthType.PERCENTAGE } })
                ] })]
            }));

            const doc = new Document({ sections: [{ properties: { page: { margin: { top: 720, right: 720, bottom: 720, left: 720 } } }, children: sections }] });
            const blob = await Packer.toBlob(doc);
            saveAs(blob, `${project.projectName.replace(/\s+/g, '_') || 'presupuesto'}_${lang}.docx`);
        };

        // --- COMPONENTE PRINCIPAL (APP) ---
        const App = () => {
            const [project, setProject] = useState({ projectName: '', beneficiary: '', approverName: '', approvalDate: new Date().toISOString().split('T')[0], observations: '' });
            const [workers, setWorkers] = useState([{ id: '1', name: '', role: 'Principal' }, { id: '2', name: '', role: 'Ayudante' }]);
            const [materials, setMaterials] = useState([{ id: Date.now().toString(), description: '', quantity: 0, unit: 'unidad', unitPrice: 0 }]);
            const [labor, setLabor] = useState([{ id: Date.now().toString(), description: '', cost: 0 }]);
            const [diet, setDiet] = useState({ workersCount: 0, days: 0, costPerDay: 0 });
            const [isGenerating, setIsGenerating] = useState(false);

            const totals = useMemo(() => {
                const materialsTotal = materials.reduce((sum, item) => sum + (item.quantity * item.unitPrice), 0);
                const laborTotal = labor.reduce((sum, item) => sum + item.cost, 0);
                const dietTotal = diet.workersCount * diet.days * diet.costPerDay;
                return { materials: materialsTotal, labor: laborTotal, diet: dietTotal, grand: materialsTotal + laborTotal + dietTotal };
            }, [materials, labor, diet]);

            const addMaterial = () => setMaterials([...materials, { id: Date.now().toString() + Math.random(), description: '', quantity: 0, unit: 'unidad', unitPrice: 0 }]);
            const removeMaterial = (id) => materials.length > 1 && setMaterials(materials.filter(m => m.id !== id));
            const updateMaterial = (id, field, value) => setMaterials(materials.map(m => m.id === id ? { ...m, [field]: value } : m));

            const addLabor = () => setLabor([...labor, { id: Date.now().toString() + Math.random(), description: '', cost: 0 }]);
            const removeLabor = (id) => labor.length > 1 && setLabor(labor.filter(l => l.id !== id));
            const updateLabor = (id, field, value) => setLabor(labor.map(l => l.id === id ? { ...l, [field]: value } : l));

            const addWorker = () => setWorkers([...workers, { id: Date.now().toString() + Math.random(), name: '', role: 'Ayudante' }]);
            const removeWorker = (id) => setWorkers(workers.filter(w => w.id !== id));

            const handleExport = async (lang) => {
                setIsGenerating(true);
                try {
                    await generateDocument(project, workers, materials, labor, diet, lang);
                } catch (error) {
                    console.error(error);
                    alert('Error al generar. Asegúrate de tener conexión a internet para cargar las librerías.');
                } finally {
                    setIsGenerating(false);
                }
            };

            const SectionTitle = ({ icon: Icon, title }) => (
                <div className="flex items-center gap-2 mb-4 pb-2 border-b border-gray-200">
                    <span className="text-primary"><Icon /></span>
                    <h2 className="text-lg font-bold text-secondary uppercase tracking-wide">{title}</h2>
                </div>
            );

            return (
                <div className="max-w-5xl mx-auto p-4 md:p-8 pb-32">
                    <header className="text-center mb-8 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h1 className="text-3xl font-extrabold text-secondary mb-2">Presupuesto de Proyecto</h1>
                        <p className="text-gray-500">Planificación y cálculo de costos de obra</p>
                    </header>

                    <div className="space-y-6">
                        {/* GENERAL */}
                        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <SectionTitle icon={Icons.ClipboardList} title="Información General" />
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Nombre del Proyecto</label>
                                    <input type="text" className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary outline-none" placeholder="Ej: Remodelación Cocina" value={project.projectName} onChange={(e) => setProject({ ...project, projectName: e.target.value })} />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Beneficiario Directo</label>
                                    <input type="text" className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary outline-none" placeholder="Nombre del cliente" value={project.beneficiary} onChange={(e) => setProject({ ...project, beneficiary: e.target.value })} />
                                </div>
                            </div>
                        </div>

                        {/* TRABAJADORES */}
                        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <SectionTitle icon={Icons.HardHat} title="Equipo de Trabajo" />
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                {workers.map((worker, index) => (
                                    <div key={worker.id} className="flex gap-2 items-end">
                                        <div className="flex-1">
                                            <label className="block text-xs font-medium text-gray-500 mb-1">{index === 0 ? 'Maestro / Principal' : `Trabajador ${index + 1}`}</label>
                                            <input type="text" className="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary outline-none" placeholder="Nombre completo" value={worker.name} onChange={(e) => { const newWorkers = [...workers]; newWorkers[index].name = e.target.value; setWorkers(newWorkers); }} />
                                        </div>
                                        {index > 0 && <button onClick={() => removeWorker(worker.id)} className="p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded"><Icons.Trash2 /></button>}
                                    </div>
                                ))}
                            </div>
                            <button onClick={addWorker} className="flex items-center gap-1 text-sm text-primary font-medium hover:text-blue-700"><Icons.Plus /> Agregar Trabajador</button>
                        </div>

                        {/* MATERIALES */}
                        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                            <SectionTitle icon={Icons.Hammer} title="Materiales" />
                            <div className="overflow-x-auto">
                                <table className="w-full min-w-[600px]">
                                    <thead>
                                        <tr className="bg-gray-50 text-left text-xs font-semibold text-gray-600 uppercase">
                                            <th className="p-3 w-8">#</th>
                                            <th className="p-3">Descripción</th>
                                            <th className="p-3 w-24">Cant.</th>
                                            <th className="p-3 w-32">Unidad</th>
                                            <th className="p-3 w-32">P. Unitario</th>
                                            <th className="p-3 w-32 text-right">Total</th>
                                            <th className="p-3 w-10"></th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {materials.map((item, idx) => (
                                            <tr key={item.id} className="hover:bg-gray-50">
                                                <td className="p-3 text-gray-400">{idx + 1}</td>
                                                <td className="p-3"><input type="text" className="w-full bg-transparent border-b border-transparent focus:border-primary outline-none" placeholder="Material..." value={item.description} onChange={(e) => updateMaterial(item.id, 'description', e.target.value)} /></td>
                                                <td className="p-3"><input type="number" min="0" className="w-full bg-transparent border-b border-transparent focus:border-primary outline-none text-center" value={item.quantity || ''} onChange={(e) => updateMaterial(item.id, 'quantity', parseFloat(e.target.value) || 0)} /></td>
                                                <td className="p-3">
                                                    <select className="w-full bg-transparent border-b border-transparent focus:border-primary outline-none text-sm" value={item.unit} onChange={(e) => updateMaterial(item.id, 'unit', e.target.value)}>
                                                        {UNITS.map(u => <option key={u.value} value={u.value}>{u.label}</option>)}
                                                    </select>
                                                </td>
                                                <td className="p-3"><input type="number" min="0" step="0.01" className="w-full bg-transparent border-b border-transparent focus:border-primary outline-none text-right" value={item.unitPrice || ''} onChange={(e) => updateMaterial(item.id, 'unitPrice', parseFloat(e.target.value) || 0)} /></td>
                                                <td className="p-3 text-right font-medium text-gray-700">${(item.quantity * item.unitPrice).toFixed(2)}</td>
                                                <td className="p-3">{materials.length > 1 && <button onClick={() => removeMaterial(item.id)} className="text-gray-300 hover:text-red-500"><Icons.Trash2 /></button>}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                    <tfoot>
                                        <tr className="bg-blue-50">
                                            <td colSpan={5} className="p-3 text-right font-bold text-blue-900">SUBTOTAL MATERIALES:</td>
                                            <td className="p-3 text-right font-bold text-blue-900">${totals.materials.toFixed(2)}</td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <button onClick={addMaterial} className="mt-4 flex items-center gap-1 text-sm text-primary font-medium hover:text-blue-700"><Icons.Plus /> Agregar Material</button>
                        </div>

                        {/* MANO DE OBRA */}
                        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <SectionTitle icon={Icons.PenTool} title="Mano de Obra" />
                            <div className="space-y-2">
                                {labor.map((item, idx) => (
                                    <div key={item.id} className="flex gap-4 items-center p-2 hover:bg-gray-50 rounded">
                                        <span className="text-gray-400 w-6">{idx + 1}.</span>
                                        <input type="text" className="flex-1 bg-transparent border-b border-gray-200 focus:border-primary outline-none py-1" placeholder="Descripción del trabajo..." value={item.description} onChange={(e) => updateLabor(item.id, 'description', e.target.value)} />
                                        <div className="w-32 relative">
                                            <span className="absolute left-0 top-1 text-gray-400">$</span>
                                            <input type="number" min="0" step="0.01" className="w-full bg-transparent border-b border-gray-200 focus:border-primary outline-none py-1 pl-4 text-right" value={item.cost || ''} onChange={(e) => updateLabor(item.id, 'cost', parseFloat(e.target.value) || 0)} />
                                        </div>
                                        <button onClick={() => removeLabor(item.id)} className={`text-gray-300 hover:text-red-500 ${labor.length <= 1 ? 'invisible' : ''}`}><Icons.Trash2 /></button>
                                    </div>
                                ))}
                            </div>
                            <div className="flex justify-between items-center mt-4">
                                <button onClick={addLabor} className="flex items-center gap-1 text-sm text-primary font-medium hover:text-blue-700"><Icons.Plus /> Agregar Trabajo</button>
                                <div className="text-right font-bold text-blue-900 bg-blue-50 px-4 py-2 rounded">Subtotal: ${totals.labor.toFixed(2)}</div>
                            </div>
                        </div>

                        {/* DIETAS */}
                        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <SectionTitle icon={Icons.Utensils} title="Alimentación / Dietas" />
                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-6">
                                <div>
                                    <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Cant. Trabajadores</label>
                                    <input type="number" min="0" className="w-full p-2 bg-gray-50 border border-gray-200 rounded text-center font-medium" value={diet.workersCount || ''} onChange={(e) => setDiet({ ...diet, workersCount: parseFloat(e.target.value) || 0 })} />
                                </div>
                                <div>
                                    <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Días Trabajados</label>
                                    <input type="number" min="0" className="w-full p-2 bg-gray-50 border border-gray-200 rounded text-center font-medium" value={diet.days || ''} onChange={(e) => setDiet({ ...diet, days: parseFloat(e.target.value) || 0 })} />
                                </div>
                                <div>
                                    <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Costo por Dieta</label>
                                    <div className="relative">
                                        <span className="absolute left-3 top-2 text-gray-400">$</span>
                                        <input type="number" min="0" step="0.01" className="w-full p-2 pl-6 bg-gray-50 border border-gray-200 rounded text-right font-medium" value={diet.costPerDay || ''} onChange={(e) => setDiet({ ...diet, costPerDay: parseFloat(e.target.value) || 0 })} />
                                    </div>
                                </div>
                            </div>
                            <div className="mt-4 text-right">
                                <span className="font-bold text-blue-900 text-lg">Total Dietas: ${totals.diet.toFixed(2)}</span>
                            </div>
                        </div>

                        {/* FIRMAS Y OBSERVACIONES */}
                        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <SectionTitle icon={Icons.FileDown} title="Aprobación" />
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Aprobado por</label>
                                    <input type="text" className="w-full p-2 border border-gray-300 rounded" value={project.approverName} onChange={(e) => setProject({ ...project, approverName: e.target.value })} />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
                                    <input type="date" className="w-full p-2 border border-gray-300 rounded" value={project.approvalDate} onChange={(e) => setProject({ ...project, approvalDate: e.target.value })} />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Observaciones</label>
                                <textarea className="w-full p-2 border border-gray-300 rounded h-24 resize-none" placeholder="Notas adicionales..." value={project.observations} onChange={(e) => setProject({ ...project, observations: e.target.value })}></textarea>
                            </div>
                        </div>

                        {/* TOTAL GLOBAL */}
                        <div className="bg-secondary text-white p-8 rounded-xl shadow-lg flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h2 className="text-2xl font-light opacity-90">Presupuesto Total</h2>
                                <p className="text-sm opacity-70 mt-1">Materiales + Mano de Obra + Dietas</p>
                            </div>
                            <div className="text-4xl md:text-5xl font-bold mt-4 md:mt-0 tracking-tight">
                                ${totals.grand.toFixed(2)} <span className="text-xl font-normal opacity-60">MN</span>
                            </div>
                        </div>

                        {/* BOTONES EXPORTAR */}
                        <div className="flex flex-col sm:flex-row justify-center gap-4 py-8">
                            <button onClick={() => handleExport('es')} disabled={isGenerating} className="flex items-center justify-center gap-2 bg-success hover:bg-green-600 text-white py-3 px-8 rounded-lg shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed">
                                {isGenerating ? 'Generando...' : <><Icons.FileDown /> Exportar Word (Español)</>}
                            </button>
                            <button onClick={() => handleExport('en')} disabled={isGenerating} className="flex items-center justify-center gap-2 bg-primary hover:bg-blue-600 text-white py-3 px-8 rounded-lg shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed">
                                {isGenerating ? 'Generating...' : <><Icons.FileDown /> Export Word (English)</>}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>